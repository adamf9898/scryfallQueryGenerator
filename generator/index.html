<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Build powerful Scryfall search queries for Magic: The Gathering cards">
  <meta name="theme-color" content="#6366f1">
  <title>Scryfall Query Generator</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîÆ</text></svg>">
</head>
<body>
  <div class="container">
    <header>
      <h1>üîÆ Scryfall Query Generator</h1>
      <p>Build powerful search queries for Magic: The Gathering cards</p>
      
      <!-- Tab Navigation -->
      <nav class="tab-nav">
        <button class="tab-btn active" data-tab="builder">Query Builder</button>
        <button class="tab-btn" data-tab="random">Random Queries</button>
        <button class="tab-btn" data-tab="data">Card Data</button>
        <button class="tab-btn" data-tab="deck">Deck Builder</button>
        <button class="tab-btn" data-tab="history">History</button>
      </nav>
    </header>

    <!-- Tab: Query Builder -->
    <main id="builder-tab" class="main-content tab-content active">
      <!-- Left Column - Form -->
      <div class="form-column">
        <form id="query-form">
          
          <!-- Card Name & Text -->
          <div class="card">
            <h2>Card Name & Text</h2>
            <div class="form-group">
              <label for="card-name">Card Name</label>
              <input type="text" id="card-name" placeholder="e.g., Lightning Bolt">
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="exact-match"> Exact name match
              </label>
            </div>
            <div class="form-group">
              <label for="oracle-text">Oracle Text (Rules Text)</label>
              <input type="text" id="oracle-text" placeholder="e.g., draw a card">
            </div>
            <div class="form-group">
              <label for="flavor-text">Flavor Text</label>
              <input type="text" id="flavor-text" placeholder="e.g., doom">
            </div>
          </div>

          <!-- Type & Color -->
          <div class="card">
            <h2>Type & Color</h2>
            <div class="form-group">
              <label for="type">Card Type</label>
              <select id="type">
                <option value="">Any type</option>
              </select>
            </div>
            <div class="form-group">
              <label>Colors</label>
              <div class="color-options">
                <label class="color-checkbox">
                  <input type="checkbox" value="w">
                  <span class="color-indicator white">W</span>
                  <span>White</span>
                </label>
                <label class="color-checkbox">
                  <input type="checkbox" value="u">
                  <span class="color-indicator blue">U</span>
                  <span>Blue</span>
                </label>
                <label class="color-checkbox">
                  <input type="checkbox" value="b">
                  <span class="color-indicator black">B</span>
                  <span>Black</span>
                </label>
                <label class="color-checkbox">
                  <input type="checkbox" value="r">
                  <span class="color-indicator red">R</span>
                  <span>Red</span>
                </label>
                <label class="color-checkbox">
                  <input type="checkbox" value="g">
                  <span class="color-indicator green">G</span>
                  <span>Green</span>
                </label>
                <label class="color-checkbox">
                  <input type="checkbox" value="c">
                  <span class="color-indicator colorless">C</span>
                  <span>Colorless</span>
                </label>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="color-mode">Color Search Mode</label>
                <select id="color-mode">
                  <option value="color">Card Color</option>
                  <option value="identity">Color Identity</option>
                </select>
              </div>
              <div class="form-group">
                <label for="color-operator">Operator</label>
                <select id="color-operator" class="operator-select">
                </select>
              </div>
            </div>
          </div>

          <!-- Mana & Stats -->
          <div class="card">
            <h2>Mana & Stats</h2>
            <div class="form-row">
              <div class="form-group">
                <label for="mana-value">Mana Value</label>
                <input type="number" id="mana-value" min="0" placeholder="e.g., 3">
              </div>
              <div class="form-group">
                <label for="mana-value-operator">Operator</label>
                <select id="mana-value-operator" class="operator-select">
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="power">Power</label>
                <input type="number" id="power" placeholder="e.g., 4">
              </div>
              <div class="form-group">
                <label for="power-operator">Operator</label>
                <select id="power-operator" class="operator-select">
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="toughness">Toughness</label>
                <input type="number" id="toughness" placeholder="e.g., 4">
              </div>
              <div class="form-group">
                <label for="toughness-operator">Operator</label>
                <select id="toughness-operator" class="operator-select">
                </select>
              </div>
            </div>
          </div>

          <!-- Rarity & Set -->
          <div class="card">
            <h2>Rarity & Set</h2>
            <div class="form-row">
              <div class="form-group">
                <label for="rarity">Rarity</label>
                <select id="rarity">
                  <option value="">Any rarity</option>
                </select>
              </div>
              <div class="form-group">
                <label for="rarity-operator">Operator</label>
                <select id="rarity-operator" class="operator-select">
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="set">Set Code</label>
              <input type="text" id="set" placeholder="e.g., dom, m21, neo">
            </div>
          </div>

          <!-- Format -->
          <div class="card">
            <h2>Format Legality</h2>
            <div class="form-group">
              <label for="format">Format</label>
              <select id="format">
                <option value="">Any format</option>
              </select>
            </div>
          </div>

          <!-- Advanced Options (Collapsible) -->
          <div class="card">
            <h2 class="collapsible">Advanced Options</h2>
            <div class="collapsible-content">
              <div class="form-group">
                <label for="artist">Artist</label>
                <input type="text" id="artist" placeholder="e.g., John Avon">
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="frame">Frame</label>
                  <select id="frame">
                    <option value="">Any frame</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="border">Border</label>
                  <select id="border">
                    <option value="">Any border</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="price-usd">Price (USD)</label>
                  <input type="number" id="price-usd" min="0" step="0.01" placeholder="e.g., 10">
                </div>
                <div class="form-group">
                  <label for="price-usd-operator">Operator</label>
                  <select id="price-usd-operator" class="operator-select">
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Keywords -->
          <div class="card">
            <h2 class="collapsible">Keywords</h2>
            <div class="collapsible-content">
              <p style="color: var(--text-secondary); margin-bottom: 0.5rem; font-size: 0.9rem;">Click to select keywords:</p>
              <div id="keywords-container" class="keyword-tags">
                <!-- Populated by JavaScript -->
              </div>
            </div>
          </div>

          <!-- Is/Not Filters -->
          <div class="card">
            <h2 class="collapsible">Card Properties (is:)</h2>
            <div class="collapsible-content">
              <p style="color: var(--text-secondary); margin-bottom: 0.5rem; font-size: 0.9rem;">Click to filter by properties:</p>
              <div id="is-filters-container" class="keyword-tags">
                <!-- Populated by JavaScript -->
              </div>
            </div>
          </div>

          <!-- Raw Query -->
          <div class="card">
            <h2 class="collapsible collapsed">Raw Query</h2>
            <div class="collapsible-content collapsed">
              <div class="form-group">
                <label for="raw-query">Add Raw Query Text</label>
                <input type="text" id="raw-query" placeholder="e.g., game:paper">
              </div>
              <p style="color: var(--text-secondary); font-size: 0.85rem;">
                Add any custom Scryfall syntax that isn't covered by the form above.
                <a href="https://scryfall.com/docs/syntax" target="_blank">Syntax Reference</a>
              </p>
            </div>
          </div>

        </form>
      </div>

      <!-- Right Column - Output -->
      <div class="output-column">
        <div class="card query-output">
          <h2>Generated Query</h2>
          <div id="query-display" class="query-display"></div>
          
          <h2 style="margin-top: 1.5rem;">Scryfall URL</h2>
          <div id="url-display" class="url-display"></div>
          
          <div class="button-group">
            <button type="button" id="search-btn" class="btn btn-primary">
              üîç Search on Scryfall
            </button>
            <button type="button" id="copy-btn" class="btn btn-secondary">
              üìã Copy Query
            </button>
            <button type="button" id="copy-url-btn" class="btn btn-secondary">
              üîó Copy URL
            </button>
            <button type="button" id="save-query-btn" class="btn btn-success">
              üíæ Save Query
            </button>
            <button type="button" id="reset-btn" class="btn btn-outline">
              ‚Ü©Ô∏è Reset
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Tab: Random Queries -->
    <section id="random-tab" class="tab-content">
      <div class="random-container">
        <div class="card">
          <h2>üé≤ Random Query Generator</h2>
          <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            Generate random Scryfall queries from 500+ curated searches across 20 categories.
          </p>
          
          <div class="form-group">
            <label for="random-category">Category</label>
            <select id="random-category">
              <option value="all">All Categories</option>
            </select>
          </div>
          
          <div class="button-group">
            <button type="button" id="generate-random-btn" class="btn btn-primary">
              üé≤ Generate Random Query
            </button>
            <button type="button" id="generate-multiple-btn" class="btn btn-secondary">
              üìã Generate 5 Queries
            </button>
          </div>
        </div>
        
        <div class="card">
          <h2>Random Query Result</h2>
          <div id="random-query-display" class="query-display"></div>
          
          <div id="random-query-url" class="url-display" style="margin-top: 1rem;"></div>
          
          <div class="button-group" style="margin-top: 1rem;">
            <button type="button" id="random-search-btn" class="btn btn-primary">
              üîç Search on Scryfall
            </button>
            <button type="button" id="random-copy-btn" class="btn btn-secondary">
              üìã Copy Query
            </button>
            <button type="button" id="random-save-btn" class="btn btn-outline">
              üíæ Save to History
            </button>
          </div>
        </div>
        
        <div class="card" id="multiple-queries-card" style="display: none;">
          <h2>Generated Queries</h2>
          <div id="multiple-queries-list" class="queries-list">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>
    </section>

    <!-- Tab: Card Data -->
    <section id="data-tab" class="tab-content">
      <div class="data-container">
        <div class="card">
          <h2>üì¶ Bulk Card Data Management</h2>
          <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            Download and manage Scryfall's complete MTG card database locally for offline access and advanced features.
          </p>
          
          <div class="form-group">
            <label for="dataset-type">Dataset Type</label>
            <select id="dataset-type">
              <option value="oracle_cards">Oracle Cards (Recommended - unique cards only)</option>
              <option value="default_cards">Default Cards (one per printing)</option>
              <option value="all_cards">All Cards (includes all variations)</option>
            </select>
          </div>
          
          <div class="button-group">
            <button type="button" id="sync-data-btn" class="btn btn-primary">
              üì• Sync Data
            </button>
            <button type="button" id="refresh-data-btn" class="btn btn-secondary">
              üîÑ Force Refresh
            </button>
            <button type="button" id="clear-data-btn" class="btn btn-outline">
              üóëÔ∏è Clear Data
            </button>
          </div>
        </div>
        
        <div class="card">
          <h2>üìä Data Status</h2>
          <div id="data-status" class="data-status">
            <div class="status-item">
              <span class="status-label">Status:</span>
              <span class="status-value" id="data-status-value">Not loaded</span>
            </div>
            <div class="status-item">
              <span class="status-label">Dataset:</span>
              <span class="status-value" id="data-dataset-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Card Count:</span>
              <span class="status-value" id="data-count-value">0</span>
            </div>
            <div class="status-item">
              <span class="status-label">Last Updated:</span>
              <span class="status-value" id="data-updated-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Last Synced:</span>
              <span class="status-value" id="data-synced-value">-</span>
            </div>
          </div>
          
          <div id="data-progress" class="progress-container" style="display: none;">
            <div class="progress-bar">
              <div class="progress-fill" id="data-progress-fill"></div>
            </div>
            <p class="progress-text" id="data-progress-text">Loading...</p>
          </div>
        </div>
        
        <div class="card">
          <h2>üîç Index Status</h2>
          <div id="index-status" class="data-status">
            <div class="status-item">
              <span class="status-label">Index Built:</span>
              <span class="status-value" id="index-built-value">No</span>
            </div>
            <div class="status-item">
              <span class="status-label">Indexed Cards:</span>
              <span class="status-value" id="index-count-value">0</span>
            </div>
            <div class="status-item">
              <span class="status-label">Build Time:</span>
              <span class="status-value" id="index-time-value">-</span>
            </div>
          </div>
          
          <div class="button-group" style="margin-top: 1rem;">
            <button type="button" id="build-index-btn" class="btn btn-primary">
              üèóÔ∏è Build Index
            </button>
            <button type="button" id="rebuild-index-btn" class="btn btn-secondary">
              üîÑ Rebuild Index
            </button>
          </div>
        </div>
        
        <div class="card">
          <h2>üîé Search Local Data</h2>
          <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            Search your locally stored card data using the index.
          </p>
          
          <div class="form-group">
            <label for="local-search-text">Text Search</label>
            <input type="text" id="local-search-text" placeholder="e.g., flying, draw a card">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="local-search-type">Type</label>
              <select id="local-search-type">
                <option value="">Any type</option>
                <option value="creature">Creature</option>
                <option value="instant">Instant</option>
                <option value="sorcery">Sorcery</option>
                <option value="enchantment">Enchantment</option>
                <option value="artifact">Artifact</option>
                <option value="planeswalker">Planeswalker</option>
                <option value="land">Land</option>
              </select>
            </div>
            <div class="form-group">
              <label for="local-search-format">Format</label>
              <select id="local-search-format">
                <option value="">Any format</option>
                <option value="standard">Standard</option>
                <option value="modern">Modern</option>
                <option value="legacy">Legacy</option>
                <option value="vintage">Vintage</option>
                <option value="commander">Commander</option>
                <option value="pioneer">Pioneer</option>
                <option value="pauper">Pauper</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="local-search-colors">Colors</label>
              <input type="text" id="local-search-colors" placeholder="e.g., ub, wubrg">
            </div>
            <div class="form-group">
              <label for="local-search-mana">Max Mana Value</label>
              <input type="number" id="local-search-mana" min="0" placeholder="e.g., 3">
            </div>
          </div>
          
          <div class="button-group">
            <button type="button" id="local-search-btn" class="btn btn-primary">
              üîç Search
            </button>
            <button type="button" id="local-search-clear-btn" class="btn btn-outline">
              ‚Ü©Ô∏è Clear
            </button>
          </div>
        </div>
        
        <div class="card" id="local-search-results-card" style="display: none;">
          <h2>Search Results</h2>
          <p class="results-count" id="local-results-count"></p>
          <div id="local-search-results" class="search-results">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>
    </section>

    <!-- Tab: Deck Builder -->
    <section id="deck-tab" class="tab-content">
      <div class="deck-container">
        <div class="card">
          <h2>üÉè Deck Configuration Generator</h2>
          <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            Generate deck configurations based on constraints. Requires card data to be loaded and indexed.
          </p>
          
          <div class="form-row">
            <div class="form-group">
              <label for="deck-format">Format</label>
              <select id="deck-format">
                <option value="standard">Standard (60 cards)</option>
                <option value="modern">Modern (60 cards)</option>
                <option value="pioneer">Pioneer (60 cards)</option>
                <option value="legacy">Legacy (60 cards)</option>
                <option value="commander">Commander (100 cards)</option>
                <option value="brawl">Brawl (60 cards)</option>
                <option value="pauper">Pauper (60 cards)</option>
                <option value="limited">Limited (40 cards)</option>
              </select>
            </div>
            <div class="form-group">
              <label for="deck-count">Number of Decks</label>
              <input type="number" id="deck-count" min="1" max="10" value="3">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="deck-colors">Color Identity (optional)</label>
              <input type="text" id="deck-colors" placeholder="e.g., ub, wubrg">
            </div>
            <div class="form-group">
              <label for="deck-max-cmc">Max Mana Value</label>
              <input type="number" id="deck-max-cmc" min="0" max="20" placeholder="No limit">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="deck-min-lands">Min Lands</label>
              <input type="number" id="deck-min-lands" min="0" max="50" placeholder="Auto">
            </div>
            <div class="form-group">
              <label for="deck-max-lands">Max Lands</label>
              <input type="number" id="deck-max-lands" min="0" max="50" placeholder="Auto">
            </div>
          </div>
          
          <div class="form-group">
            <label for="deck-must-include">Must Include Cards (comma-separated)</label>
            <input type="text" id="deck-must-include" placeholder="e.g., Lightning Bolt, Counterspell">
          </div>
          
          <div class="button-group">
            <button type="button" id="generate-deck-btn" class="btn btn-primary">
              üé≤ Generate Decks
            </button>
            <button type="button" id="clear-decks-btn" class="btn btn-outline">
              ‚Ü©Ô∏è Clear Results
            </button>
          </div>
        </div>
        
        <div class="card" id="deck-results-card" style="display: none;">
          <h2>Generated Decks</h2>
          <div id="deck-results" class="deck-results">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>
    </section>

    <!-- Tab: History -->
    <section id="history-tab" class="tab-content">
      <div class="history-container">
        <div class="card">
          <h2>üìú Query History</h2>
          <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            Your saved and recently used queries. History is stored in your browser.
          </p>
          
          <div class="button-group">
            <button type="button" id="clear-history-btn" class="btn btn-outline">
              üóëÔ∏è Clear History
            </button>
            <button type="button" id="export-history-btn" class="btn btn-secondary">
              üì§ Export History
            </button>
          </div>
        </div>
        
        <div class="card">
          <h2>Saved Queries</h2>
          <div id="history-list" class="queries-list">
            <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">
              No saved queries yet. Use the Query Builder or Random Generator to create queries.
            </p>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <p>
        Built with the <a href="https://github.com/adamf9898/scryfallQueryGenerator">Scryfall Query Generator</a> library.
        <br>
        <a href="https://scryfall.com" target="_blank">Scryfall</a> is a trademark of Scryfall LLC.
        Magic: The Gathering is a trademark of Wizards of the Coast.
      </p>
    </footer>
  </div>

  <!-- Notification -->
  <div id="notification" class="notification"></div>

  <!-- Load additional modules -->
  <script src="bulk-data.js"></script>
  <script src="card-normalizer.js"></script>
  <script src="card-search-index.js"></script>
  <script src="deck-generator.js"></script>
  <script src="app.js"></script>
</body>
</html>
